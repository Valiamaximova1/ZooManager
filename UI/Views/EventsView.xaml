<UserControl x:Class="UI.Views.EventsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:vm="clr-namespace:UI.ViewModels"
             xmlns:shared="clr-namespace:Shared.Enums;assembly=Shared"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:converters="clr-namespace:UI.Converters"
             xmlns:behaviors="clr-namespace:UI.Behaviors">

    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:BoolToGridLengthConverter x:Key="BoolToGridLengthConverter" />
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Filters -->
        <StackPanel Orientation="Horizontal" Margin="0 0 0 10">
            <DatePicker SelectedDate="{Binding SelectedDate}" Margin="0 0 10 0" />
            <ComboBox ItemsSource="{Binding EventTypes}"
                      SelectedItem="{Binding SelectedType}"
                      Width="150"
                      Margin="0 0 10 0" />
            <Button Content="Търси"
                    Command="{Binding SearchCommand}"
                    Width="100" />
        </StackPanel>

        <!-- Events list -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="{Binding IsDetailsVisible, Converter={StaticResource BoolToGridLengthConverter}, ConverterParameter='*;3*'}"/>
                <ColumnDefinition Width="{Binding IsDetailsVisible, Converter={StaticResource BoolToGridLengthConverter}, ConverterParameter='0;*'}"/>
            </Grid.ColumnDefinitions>

            <!-- Таблица със събития -->
            <DataGrid ItemsSource="{Binding Events}"
              SelectedItem="{Binding SelectedEvent, Mode=TwoWay}"
              AutoGenerateColumns="False"
              Margin="0 0 10 0"
              Grid.Column="0"
              IsReadOnly="True">
                <i:Interaction.Behaviors>
                    <behaviors:DataGridDoubleClickBehavior Command="{Binding EditEventCommand}" />
                </i:Interaction.Behaviors>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Заглавие" Binding="{Binding Title}" Width="*" />
                    <DataGridTextColumn Header="Тип" Binding="{Binding Type}" Width="*" />
                    <DataGridTextColumn Header="Дата" Binding="{Binding Date, StringFormat=dd.MM.yyyy}" Width="*" />
                </DataGrid.Columns>
            </DataGrid>

            <!-- Панел с детайли -->
            <Border Grid.Column="1"
            Visibility="{Binding IsDetailsVisible, Converter={StaticResource BoolToVisibilityConverter}}"
            BorderThickness="1"
            BorderBrush="Gray"
            Padding="10"
            Background="#FAFAFA">
                <StackPanel Width="200">
                    <TextBlock Text="Заглавие:" FontWeight="Bold" />
                    <ContentControl Content="{Binding}">
                        <ContentControl.Style>
                            <Style TargetType="ContentControl">
                                <Setter Property="ContentTemplate">
                                    <Setter.Value>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding SelectedEvent.Title}" />
                                        </DataTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsEditMode}" Value="True">
                                        <Setter Property="ContentTemplate">
                                            <Setter.Value>
                                                <DataTemplate>
                                                    <TextBox Text="{Binding EditingEvent.Title, Mode=TwoWay}" />
                                                </DataTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                    </ContentControl>


                    <TextBlock Text="Описание:" FontWeight="Bold" Margin="0 10 0 0" />
                    <!--   <TextBlock Text="{Binding SelectedEvent.Description}" 
                       TextWrapping="Wrap" MaxWidth="180"   /> -->

                    <ContentControl>
                        <ContentControl.Style>
                            <Style TargetType="ContentControl">
                                <Setter Property="Content">
                                    <Setter.Value>
                                        <TextBlock Text="{Binding SelectedEvent.Description}" TextWrapping="Wrap" MaxWidth="180"  />
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsEditMode}" Value="True">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <TextBox Text="{Binding EditingEvent.Description, Mode=TwoWay}" TextWrapping="Wrap" MaxWidth="180"  AcceptsReturn="True" />
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                    </ContentControl>


                    <TextBlock Text="Дата:" FontWeight="Bold" Margin="0 10 0 0" />
                    <ContentControl>
                        <ContentControl.Style>
                            <Style TargetType="ContentControl">
                                <Setter Property="Content">
                                    <Setter.Value>
                                        <TextBlock Text="{Binding SelectedEvent.Date, StringFormat=dd.MM.yyyy}" />
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsEditMode}" Value="True">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <DatePicker SelectedDate="{Binding EditingEvent.Date, Mode=TwoWay}" />
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                    </ContentControl>

                    <TextBlock Text="Тип:" FontWeight="Bold" Margin="0 10 0 0" />
                    <ContentControl>
                        <ContentControl.Style>
                            <Style TargetType="ContentControl">
                                <Setter Property="Content">
                                    <Setter.Value>
                                        <TextBlock Text="{Binding SelectedEvent.Type}" />
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsEditMode}" Value="True">
                                        <Setter Property="Content">
                                            <Setter.Value>
                                                <ComboBox ItemsSource="{Binding EventTypes}"
                                              SelectedItem="{Binding EditingEvent.Type, Mode=TwoWay}" />
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                    </ContentControl>


                    <TextBlock Text="Животни:" FontWeight="Bold" Margin="0 10 0 0"/>
                    <ItemsControl ItemsSource="{Binding SelectedAnimals}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Name}" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>

                     </ItemsControl> 

                    <StackPanel Orientation="Horizontal" Margin="0 10 0 0">
                        <Button Content="Запази"
                    Command="{Binding SaveEventCommand}"
                    IsEnabled="{Binding IsEditMode}"
                    Margin="0 0 5 0"/>
                        <Button Content="Изтрий"
                    Command="{Binding DeleteEventCommand}"
                    Foreground="Red" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>


        <!-- Таблица със събития
            <DataGrid ItemsSource="{Binding Events}"
                      SelectedItem="{Binding SelectedEvent, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      Margin="0 0 10 0"
                      Grid.Column="0"
                      IsReadOnly="True">
                <i:Interaction.Behaviors>
                    <behaviors:DataGridDoubleClickBehavior Command="{Binding EditEventCommand}" />
                    <behaviors:DataGridDeleteKeyBehavior Command="{Binding DeleteEventCommand}" />
                </i:Interaction.Behaviors>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Заглавие" Binding="{Binding Title}" Width="*" />
                    <DataGridTextColumn Header="Тип" Binding="{Binding Type}" Width="*" />
                    <DataGridTextColumn Header="Дата" Binding="{Binding Date, StringFormat=dd.MM.yyyy}" Width="*" />
                </DataGrid.Columns>
            </DataGrid> -->

            <!-- Детайли / Редакция 
            <Border Grid.Column="1"
                    Visibility="{Binding IsDetailsVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                    BorderThickness="1"
                    BorderBrush="Gray"
                    Padding="10">
                <StackPanel Width="300">
                    <TextBlock Text="Заглавие:" FontWeight="Bold" />
                    <TextBox Text="{Binding EditingEvent.Title}" IsEnabled="{Binding IsEditMode}" />

                    <TextBlock Text="Описание:" FontWeight="Bold" Margin="0 10 0 0" />
                    <TextBox Text="{Binding EditingEvent.Description}" Height="60" AcceptsReturn="True" IsEnabled="{Binding IsEditMode}" />

                    <TextBlock Text="Дата:" FontWeight="Bold" Margin="0 10 0 0" />
                    <DatePicker SelectedDate="{Binding EditingEvent.Date}" IsEnabled="{Binding IsEditMode}" />

                    <TextBlock Text="Тип:" FontWeight="Bold" Margin="0 10 0 0" />
                    <ComboBox ItemsSource="{Binding Types}" SelectedItem="{Binding EditingEvent.Type}" IsEnabled="{Binding IsEditMode}" />

                    <Button Content="Запази" Command="{Binding SaveEventCommand}" Margin="0 10 0 0"
                            Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVisibilityConverter}}" />

                    <Button Content="Изтрий" Command="{Binding DeleteEventCommand}" Margin="0 5 0 0" />
                </StackPanel>
            </Border>-->
       
    </Grid>
</UserControl>