<UserControl x:Class="UI.Views.EventsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:UI.ViewModels"
             xmlns:shared="clr-namespace:Shared.Enums;assembly=Shared"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:converters="clr-namespace:UI.Converters">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Filters -->
        <StackPanel Orientation="Horizontal" Margin="0 0 0 10">
            <DatePicker SelectedDate="{Binding SelectedDate}" Margin="0 0 10 0"/>
            <ComboBox ItemsSource="{Binding EventTypes}"
                      SelectedItem="{Binding SelectedType}"
                      Width="150"
                      Margin="0 0 10 0"/>
            <Button Content="Търси"
                    Command="{Binding SearchCommand}"
                    Width="100"/>
        </StackPanel>

        <!-- Events list -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>

            <!-- Events Table -->
            <DataGrid ItemsSource="{Binding Events}" 
                      SelectedItem="{Binding SelectedEvent}" 
                      AutoGenerateColumns="False" 
                      Margin="10"
                      MouseDoubleClick="DataGrid_MouseDoubleClick"
                      KeyDown="{Binding KeyDownCommand, Mode=OneWay}">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Заглавие" Binding="{Binding Title}" />
                    <DataGridTextColumn Header="Тип" Binding="{Binding Type}" />
                    <DataGridTextColumn Header="Дата" Binding="{Binding Date}" />
                </DataGrid.Columns>
            </DataGrid>

            <!-- Details/Edit -->
            <Border Grid.Column="1" Background="#f7f7f7" Padding="10" Visibility="{Binding IsDetailsVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel>
                    <TextBlock FontWeight="Bold" FontSize="16" Text="Детайли за събитието" Margin="0 0 0 10"/>

                    <StackPanel Orientation="Vertical" Margin="0 5">
                        <TextBlock Text="Заглавие:"/>
                        <TextBox Text="{Binding EditingEvent.Title}" />
                    </StackPanel>

                    <StackPanel Orientation="Vertical" Margin="0 5">
                        <TextBlock Text="Описание:"/>
                        <TextBox Text="{Binding EditingEvent.Description}" AcceptsReturn="True" Height="60"/>
                    </StackPanel>

                    <StackPanel Orientation="Vertical" Margin="0 5">
                        <TextBlock Text="Дата:"/>
                        <DatePicker SelectedDate="{Binding EditingEvent.Date}" />
                    </StackPanel>

                    <StackPanel Orientation="Vertical" Margin="0 5">
                        <TextBlock Text="Тип:"/>
                        <ComboBox ItemsSource="{Binding Source={x:Static sys:Enum.GetValues, Type={x:Type shared:EventType}}}"
                                  SelectedItem="{Binding EditingEvent.Type}" />
                    </StackPanel>

                    <Button Content="Запази" Command="{Binding SaveEventCommand}" Margin="0 10 0 0"/>
                    <Button Content="Изтрий" Command="{Binding DeleteEventCommand}" Background="Red" Foreground="White" />
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
